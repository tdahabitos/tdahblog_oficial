---
export type MagCardData = {
  href: string;

  kicker?: string;         // "CARACTERÍSTICA", "PERGUNTAS E RESPOSTAS"...
  title: string;
  excerpt?: string;

  author?: string;
  dateLabel?: string;      // "21 de janeiro de 2026"

  image?: string;          // imagem do topo
  imageAlt?: string;

  bgImage?: string;        // imagem de fundo (sutil) atrás do texto
  variant?: "green" | "black"; // green = Nature (print 1/2), black = "More from" (print 3)
};

const {
  href,
  kicker,
  title,
  excerpt,
  author,
  dateLabel,
  image,
  imageAlt = "",
  bgImage,
  variant = "green",
} = Astro.props as MagCardData;

const aria = kicker ? `${kicker}: ${title}` : title;

// CSS vars inline para bg opcional
const styleVars = bgImage ? `--card-bg-image: url('${bgImage}')` : undefined;
---

<article class={`magCard magCard--${variant}`} style={styleVars}>
  <a class="magLink" href={href} aria-label={aria}>
    {image && (
      <div class="magMedia" aria-hidden="true">
        <img class="magImg" src={image} alt={imageAlt} loading="lazy" decoding="async" />
      </div>
    )}

    <div class="magBody">
      {kicker && <div class="magKicker">{kicker}</div>}

      <h3 class="magTitle">{title}</h3>

      {excerpt && <p class="magExcerpt">{excerpt}</p>}

      {(author || dateLabel) && (
        <div class="magMeta">
          {author && (
            <span class="magAuthor">
              Por <strong>{author}</strong>
            </span>
          )}
          {dateLabel && <span class="magDate">{dateLabel}</span>}
        </div>
      )}
    </div>
  </a>
</article>

<style>
  .magCard {
    border-radius: 22px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.10);
    box-shadow: 0 18px 40px rgba(0,0,0,.28);
  }

  .magLink {
    display: grid;
    text-decoration: none;
    color: inherit;
    outline: none;
  }

  .magLink:focus-visible {
    outline: 3px solid var(--color-brand-soft, rgba(180, 130, 255, .9));
    outline-offset: 4px;
    border-radius: 18px;
  }

  /* Imagem topo */
  .magMedia {
    aspect-ratio: 16 / 9;
    background: rgba(255,255,255,0.04);
  }
  .magImg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Corpo */
  .magBody {
    position: relative;
    padding: 22px;
  }

  /* BG opcional (imagem “fantasma” atrás do texto) */
  .magBody::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image: var(--card-bg-image);
    background-size: cover;
    background-position: center;
    opacity: 0;
    pointer-events: none;
  }

  /* Overlay por cima do bg para manter leitura */
  .magBody::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 0;
  }

  .magKicker,
  .magTitle,
  .magExcerpt,
  .magMeta {
    position: relative;
    z-index: 1;
  }

  .magKicker {
    font: 800 0.78rem/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    opacity: 0.92;
    margin-bottom: 10px;
  }

  .magTitle {
    font-family: "Playfair Display", serif;
    font-size: clamp(1.35rem, 2.2vw, 1.95rem);
    line-height: 1.08;
    letter-spacing: -0.02em;
    margin: 0 0 10px 0;
  }

  .magExcerpt {
    margin: 0 0 14px 0;
    line-height: 1.65;
    opacity: 0.92;
    max-width: 62ch;
  }

  .magMeta {
    display: flex;
    flex-wrap: wrap;
    gap: 10px 14px;
    align-items: baseline;
    font-size: 0.95rem;
    opacity: 0.95;
  }
  .magAuthor strong {
    font-weight: 900;
  }

  /* Variantes de cor (verde Nature x preto “More from”) */
  .magCard--green {
    background: var(--mag-green, #0f4b46);
    color: var(--mag-green-fg, #f4efe7);
  }

  .magCard--black {
    background: #0b0b0b;
    color: #f2f2f2;
    border-color: rgba(255,255,255,0.08);
    box-shadow: none;
    border-radius: 0; /* o print “More from” é mais reto */
  }

  .magCard--black .magMedia {
    aspect-ratio: 16 / 10;
  }

  /* Ativa background image (quando bgImage existe) */
  .magCard[style*="--card-bg-image"] .magBody::before {
    opacity: 0.18;
    filter: saturate(0.9) contrast(1.05);
  }

  .magCard--green[style*="--card-bg-image"] .magBody::after {
    opacity: 1;
    background: linear-gradient(to bottom, rgba(15,75,70,0.55), rgba(15,75,70,0.92));
  }

  .magCard--black[style*="--card-bg-image"] .magBody::after {
    opacity: 1;
    background: linear-gradient(to bottom, rgba(0,0,0,0.45), rgba(0,0,0,0.92));
  }

  @media (hover: hover) {
    .magCard--green:hover {
      transform: translateY(-2px);
      transition: transform 180ms ease, box-shadow 180ms ease;
      box-shadow: 0 24px 54px rgba(0,0,0,.32);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .magCard--green:hover { transform: none; }
  }
</style>