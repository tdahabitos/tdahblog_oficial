---
import Head from "../components/head.astro";
import "../styles/tdahblog.css";

interface Props {
  title?: string;
  description?: string;
  hideFooter?: boolean;

  // ✅ SEO técnico + Social (Parte 7)
  canonical?: string;
  ogImage?: string;
  ogType?: "website" | "article";
  noindex?: boolean;
}

const {
  title = "VivaTDAH",
  description = "Conteúdo informativo e acessível sobre TDAH",
  hideFooter = false,

  canonical,
  ogImage,
  ogType = "website",
  noindex = false,
} = Astro.props as Props;
---

<!DOCTYPE html>
<html lang="pt-br">
  <Head
    title={title}
    description={description}
    canonical={canonical}
    ogImage={ogImage}
    ogType={ogType}
    noindex={noindex}
  />

  <body>
    <script is:inline>
      // ✅ adicional necessário: evita erro em SSR/build (localStorage só existe no browser)
      if (typeof window !== "undefined") {
        try {
          const saved = localStorage.getItem("theme");
          if (saved === "dark") document.documentElement.setAttribute("data-theme", "dark");
          if (saved === "light") document.documentElement.removeAttribute("data-theme");
        } catch {}
      }
    </script>

    <style>
      :root {
        --lav-050: #ddd6ff;
        --lav-300: #8371cd;
        --lav-500: #6e42a7;
        --lav-700: #4d398c;
        --sun-400: #f6e541;

        --topbar-bg: linear-gradient(180deg, #0b0b0c 0%, #14141a 100%);
        --topbar-border: rgba(221, 214, 255, 0.16);

        /* ✅ ADD: fundo da página continua o “clima” do header */
        --page-bg: linear-gradient(180deg, #0b0b0c 0%, #14141a 320px, var(--color-surface-0, #14141a) 720px);

        --brand-color: #ffffff;

        --pill-bg: rgba(110, 66, 167, 0.22);
        --pill-border: rgba(221, 214, 255, 0.34);
        --pill-text: rgba(255, 255, 255, 0.96);

        --pill-bg-hover: rgba(110, 66, 167, 0.35);
        --pill-border-hover: rgba(246, 229, 65, 0.70);

        --menu-bg: #120f1d;
        --menu-border: rgba(221, 214, 255, 0.18);
        --menu-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);

        --menu-item: rgba(255, 255, 255, 0.92);
        --menu-item-hover: rgba(221, 214, 255, 0.10);

        --focus-ring: rgba(246, 229, 65, 0.95);
      }

      html[data-theme="dark"] {
        --topbar-bg: linear-gradient(180deg, #262646 0%, #1b1b33 100%);
        --topbar-border: rgba(221, 214, 255, 0.14);

        /* ✅ ADD: fundo da página (dark) */
        --page-bg: linear-gradient(180deg, #262646 0%, #1b1b33 320px, var(--color-surface-0, #120f1d) 720px);

        --pill-bg: rgba(77, 57, 140, 0.28);
        --pill-border: rgba(221, 214, 255, 0.32);
        --pill-bg-hover: rgba(77, 57, 140, 0.44);
        --pill-border-hover: rgba(246, 229, 65, 0.75);

        --menu-bg: #0d0b12;
        --menu-border: rgba(221, 214, 255, 0.16);
      }

      /* ✅ ADD: fallback de fundo sem “matar” o global.css */
      html { background: var(--page-bg); }

      body {
        margin: 0;
        /* ✅ REMOVIDO: não força background aqui (global.css fica como fonte da verdade) */
      }

      .topbar {
        position: sticky;
        top: 0;
        z-index: 50;
        background: var(--topbar-bg);
        border-bottom: 1px solid var(--topbar-border);
        overflow: visible;
        padding-bottom: 0;
      }

      main.w-full.flex-1 { padding-top: 0 !important; }
      main.w-full.flex-1 > :first-child { margin-top: 0 !important; padding-top: 0 !important; }

      .topbar-inner {
        max-width: 980px;
        margin: 0 auto;
        padding: 0 18px;
        min-height: 56px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
        overflow: visible;
      }

      .brand {
        /* ✅ AJUSTE: Fonte estilo Nature */
        font-family: 'Playfair Display', serif;
        color: var(--brand-color);
        text-decoration: none;
        font-weight: 700;
        letter-spacing: -0.01em;
        font-size: 1.6rem;
        flex: 0 0 auto;
        line-height: 1;
      }

      .topbar-inner .nav{
        margin-left: auto;
        width: max-content;
        flex: 0 0 auto;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 12px;
        flex-wrap: nowrap;
        overflow: visible;
      }

      .topbar-inner .nav .nav-link{
        white-space: nowrap;
      }

      .nav-link {
        appearance: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;

        width: auto;
        min-width: 0;
        white-space: nowrap;

        border: 1px solid var(--pill-border);
        background: var(--pill-bg);
        color: var(--pill-text);

        padding: 6px 12px;
        font-size: 0.92rem;
        font-weight: 650;
        line-height: 1;

        cursor: pointer;
        text-decoration: none;
      }

      .nav-link:hover {
        background: var(--pill-bg-hover);
        border-color: var(--pill-border-hover);
      }

      .nav-link:focus-visible {
        outline: 2px solid var(--focus-ring);
        outline-offset: 3px;
      }

      .nav-trigger .chev {
        font-size: 0.7rem;
        opacity: 0.9;
        transform: translateY(1px);
      }

      .dropdown {
        position: relative;
        display: inline-flex;
        align-items: center;
        background: transparent;
        border: none;
        padding: 0;
        border-radius: 0;
        overflow: visible;
      }

      .menu {
        position: absolute;
        top: calc(100% + 6px);
        left: 0;
        z-index: 999;

        min-width: 220px;
        background: var(--menu-bg);
        border: 1px solid var(--menu-border);
        border-radius: 10px;
        padding: 6px;

        display: none;
        box-shadow: var(--menu-shadow);
      }

      .menu a {
        display: block;
        width: 100%;
        border: none;
        background: transparent;

        padding: 8px 10px;
        border-radius: 8px;
        font-weight: 650;
        color: var(--menu-item);
        text-decoration: none;
        line-height: 1.15;
      }

      .menu a:hover {
        background: var(--menu-item-hover);
      }

      .menu a:focus-visible {
        outline: 2px solid var(--focus-ring);
        outline-offset: 2px;
      }

      .dropdown[data-open="true"] .menu {
        display: block;
      }

      @media (max-width: 740px) {
        .topbar-inner {
          flex-wrap: wrap;
          justify-content: center;
          padding: 10px 12px;
          gap: 10px;
          min-height: 0;
          align-items: center;
        }
        .brand {
          width: 100%;
          text-align: center;
        }
        .topbar-inner .nav {
          width: 100%;
          margin-left: 0;
          flex-wrap: wrap;
          justify-content: center;
          gap: 10px;
        }
      }
    </style>

    <header class="topbar">
      <div class="topbar-inner">
        <a class="brand" href="/">VivaTDAH</a>

        <nav class="nav" aria-label="Navegação principal">
          <button class="nav-link" type="button" id="btn-inicio" onclick="if(document.getElementById('welcome-area')){ document.getElementById('welcome-area').style.display='block'; window.scrollTo({top: 0, behavior: 'smooth'}); } else { window.location.href='/'; }">
            Início
          </button>

          <div class="dropdown" data-dropdown>
            <button
              class="nav-link nav-trigger"
              type="button"
              data-trigger
              aria-haspopup="true"
              aria-expanded="false"
            >
              Seções <span class="chev">▼</span>
            </button>

            <div class="menu" role="menu">
              <a role="menuitem" href="/diagnostico">Diagnóstico</a>
              <a role="menuitem" href="/regulacao">Regulação</a>
              <a role="menuitem" href="/estrategias">Estratégias</a>
              <a role="menuitem" href="/ciencia">Ciência</a>
              <a role="menuitem" href="/recursos">Recursos</a>
            </div>
          </div>

          <a class="nav-link" href="/sobre">Sobre</a>

          <div class="dropdown" data-dropdown>
            <button
              class="nav-link nav-trigger"
              type="button"
              data-trigger
              aria-haspopup="true"
              aria-expanded="false"
            >
              Extras <span class="chev">▼</span>
            </button>

            <div class="menu" role="menu">
              <a role="menuitem" href="/categoria/geral">Categorias</a>
              <a role="menuitem" href="/trilhas">Trilhas</a>
              <a role="menuitem" href="/sobre">Sobre a Empresa</a>
              <a role="menuitem" href="/contato">Contato</a>
            </div>
          </div>

          <button class="nav-link" type="button" id="themeToggle" aria-label="Alternar tema" style="padding: 6px 10px; display: inline-flex; align-items: center; justify-content: center;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
        </nav>
      </div>
    </header>

    <main class="w-full flex-1">
      <slot />
    </main>

    {!hideFooter && (
      <footer>
        <div style="max-width: var(--layout-containerMax); margin: 0 auto; padding: 28px 32px; font-size: .9rem; color: var(--color-text-secondary);">
          © {new Date().getFullYear()} VivaTDAH — Todos os direitos reservados
        </div>
      </footer>
    )}

    <script is:inline>
      // ✅ adicional necessário: evita rodar em SSR/build por acidente
      if (typeof window !== "undefined") {
        // Dropdown toggle
        const dropdowns = document.querySelectorAll("[data-dropdown]");
        dropdowns.forEach((dd) => {
          const btn = dd.querySelector("[data-trigger]");
          const close = () => {
            dd.dataset.open = "false";
            btn?.setAttribute("aria-expanded", "false");
          };
          const open = () => {
            dd.dataset.open = "true";
            btn?.setAttribute("aria-expanded", "true");
          };

          btn?.addEventListener("click", (e) => {
            e.stopPropagation();
            dd.dataset.open === "true" ? close() : open();
          });

          document.addEventListener("click", close);
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") close();
          });
        });

        // Tema persistente (data-theme="dark")
        const toggle = document.getElementById("themeToggle");
        toggle?.addEventListener("click", () => {
          const isDark = document.documentElement.getAttribute("data-theme") === "dark";
          if (isDark) {
            document.documentElement.removeAttribute("data-theme");
            try { localStorage.setItem("theme", "light"); } catch {}
          } else {
            document.documentElement.setAttribute("data-theme", "dark");
            try { localStorage.setItem("theme", "dark"); } catch {}
          }
        });
      }
    </script>
  </body>
</html>