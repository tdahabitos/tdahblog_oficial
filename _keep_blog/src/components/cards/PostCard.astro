---
type Media = { url?: string; alt?: string };
type CategoryLite = { title?: string; slug?: string };
type PostLite = {
  title: string;
  slug: string;
  description?: string;
  cover?: Media;
  category?: CategoryLite;
  hub?: string;
  createdAt?: string;
};

const {
  post,
  href,
  eyebrow,
} = Astro.props as {
  post: PostLite;
  href?: string;
  eyebrow?: string; // ex: "Comece aqui"
};

const url = href ?? `/post/${post.slug}`;
const coverUrl = post.cover?.url;
const coverAlt = post.cover?.alt ?? post.title;
const categoryLabel = post.category?.title;
const categoryHref = post.category?.slug ? `/categoria/${post.category.slug}` : null;

function formatDate(iso?: string) {
  if (!iso) return "";
  const d = new Date(iso);
  if (Number.isNaN(d.getTime())) return "";
  return d.toLocaleDateString("pt-BR", { day: "2-digit", month: "short", year: "numeric" });
}
---
<article class="ui-card ui-card--post">
  <a class="ui-card__link" href={url} aria-label={post.title}>
    {coverUrl && (
      <div class="ui-card__media">
        <img src={coverUrl} alt={coverAlt} loading="lazy" decoding="async" />
      </div>
    )}

    <div class="ui-card__body">
      <div class="ui-card__meta">
        {eyebrow && <span class="ui-chip">{eyebrow}</span>}
        {categoryLabel && categoryHref && (
          <a class="ui-chip ui-chip--link" href={categoryHref} onClick={(e) => e.stopPropagation()}>
            {categoryLabel}
          </a>
        )}
        {!categoryHref && categoryLabel && <span class="ui-chip">{categoryLabel}</span>}
        {post.createdAt && <span class="ui-meta">{formatDate(post.createdAt)}</span>}
      </div>

      <h3 class="ui-card__title">{post.title}</h3>

      {post.description && <p class="ui-card__desc">{post.description}</p>}

      <div class="ui-card__cta">
        <span class="ui-link">Ler</span>
      </div>
    </div>
  </a>
</article>